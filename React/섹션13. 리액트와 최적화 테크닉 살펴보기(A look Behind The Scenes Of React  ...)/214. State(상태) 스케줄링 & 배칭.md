좋습니다! 이번 강의에서는 **React의 상태(state) 업데이트 타이밍과 실행 스케줄**, 그리고 **배칭(batch) 처리의 동작 원리**까지 아주 중요한 내용을 다루고 있습니다. 이 개념은 초보자에게는 다소 혼동될 수 있지만, 이해하면 실무에서 훨씬 **예측 가능한 상태 관리**가 가능해집니다.

아래는 이 내용을 **블로그 포스팅용**으로 정리한 글입니다.

---

# ⏱️ React 상태 업데이트는 언제 실행될까? — 스케줄, 함수형 업데이트, 배칭까지

리액트에서 상태를 변경하려고 `setState()` 혹은 `useState`의 `setX` 함수를 호출하면,  
**당장 값이 바뀌는 것처럼 보이지만 실제로는 즉시 반영되지 않습니다.**

이번 글에서는 상태 업데이트가 **어떻게 지연(scheduled)**되고,  
**왜 함수형 업데이트를 써야 할 때가 있는지**, 그리고 **React가 어떻게 성능을 위해 배칭(batch) 처리**하는지를 알아봅니다.

---

## 🧠 상태 업데이트는 "즉시 실행"되지 않는다

```jsx
setChosenCount(10);
console.log(chosenCount); // ❌ 아직 10이 아님!
```

이런 코드에서 `console.log`는 **이전 상태**만 출력합니다.  
왜냐하면 `setState()` 호출은 **비동기적이며 예약(scheduled)**되기 때문입니다.

✔️ 리액트는 상태를 변경한 뒤 컴포넌트를 **재실행하고**,  
그 재실행 시점에만 **업데이트된 상태가 반영**됩니다.

---

## ✅ 함수형 업데이트를 사용하는 이유

```jsx
setChosenCount(prev => prev + 1);
```

이 방식은 **이전 상태 값에 의존한 새로운 상태 계산**이 필요한 경우 필수입니다.

> 예시: `setChosenCount(chosenCount + 1)` ← 이건 동기적으로 실행될 것처럼 보이지만  
> 리액트가 상태를 큐에 넣기 때문에 **이전 상태 값**을 기준으로 하게 되어 오류 발생 가능성이 큽니다.

✔️ 함수형 업데이트는 항상 최신 상태 값을 **보장**받습니다.  
✔️ 여러 개의 상태 업데이트가 **동시에 예약되어도**, 정확한 값을 계산할 수 있습니다.

---

## 🧪 문제 예시: 잘못된 상태 참조

```jsx
setChosenCount(chosenCount + 1); // chosenCount는 아직 이전 값
setAnotherState(chosenCount + 5); // 여기도 마찬가지
```

이 경우 `chosenCount`가 **아직 0**이라면, 두 값 모두 **0을 기준으로 계산**됩니다.  
기대한 결과보다 **낮은 숫자**가 설정됩니다.

---

## 🛠 해결 방법: 함수형 업데이트

```jsx
setChosenCount(prev => prev + 1);
setAnotherState(prev => prev + 5);
```

이렇게 하면 리액트는 내부에서 예약된 순서대로 상태를 업데이트하면서  
**각 업데이트 함수에 최신 상태 값을 자동으로 전달**합니다.

---

## 🧩 상태 업데이트가 많아도 컴포넌트는 한 번만 실행된다?

```jsx
setCountA(10);
setCountB(20);
```

이처럼 여러 상태 업데이트가 하나의 함수 안에서 일어난다면,  
리액트는 이들을 **자동으로 배칭(batch)** 처리합니다.

### 🔄 배칭이란?

> 여러 개의 상태 업데이트를 **묶어서 한 번의 컴포넌트 재실행으로 처리**하는 최적화 방식입니다.

```jsx
console.log("컴포넌트 렌더링!");
```

- 상태를 2개 바꿔도 → 로그는 한 번 출력됨
    
- **컴포넌트 함수는 딱 한 번만 실행됨**
    

---

## 🔍 상태 스케줄과 배칭 요약

|항목|설명|
|---|---|
|상태는 즉시 변경되는가?|❌ No, 비동기적 스케줄|
|상태 변경 직후 사용 가능?|❌ 아직 이전 값일 수 있음|
|최신 상태 기준으로 업데이트하려면?|✅ 함수형 업데이트 사용|
|여러 상태 업데이트 시|✅ 자동 배칭되어 컴포넌트 1회 실행|

---

## 📌 요약 정리

|개념|요점 설명|
|---|---|
|상태 업데이트 지연|`setState`는 즉시 반영되지 않음|
|함수형 업데이트 사용|이전 값을 기준으로 정확하게 상태 갱신 가능|
|상태 배칭 처리|여러 상태 업데이트가 동시에 발생해도 컴포넌트는 1회만 실행|
|console에서 확인 불가|상태는 다음 렌더링에서만 반영됨|

---

## 💡 결론

React의 상태 업데이트는 단순한 변수 할당이 아닙니다.  
**예약된 방식으로, 일정한 흐름에 따라 조정되고 처리**됩니다.

그리고 이 과정을 정확히 이해하면:

- 상태 꼬임 방지
    
- 예상치 못한 UI 오류 디버깅
    
- 성능 최적화
    

등에서 훨씬 더 안정적이고 효율적인 리액트 코드를 작성할 수 있게 됩니다.

---

다음 글에서는 상태 업데이트와 관련하여  
**비동기 로직 안에서의 상태 처리**, 예를 들어 `fetch` 후에 상태를 안전하게 업데이트하는 방법을 소개할 예정이에요!

필요하시면 위 예제를 `동기 vs 함수형 업데이트` 비교 코드로도 정리해드릴 수 있습니다. 원하시나요? 😄